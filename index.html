<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fuel Tracker</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: linear-gradient(to right, #f9f9f9, #e0f7fa);
      color: #333;
    }
    header {
      background: #00796b;
      color: white;
      padding: 1rem;
      text-align: center;
    }
    .container {
      max-width: 900px;
      margin: 2rem auto;
      padding: 1rem;
    }
    .card {
      background: white;
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    label { display: block; margin-top: 0.5rem; }
    input, textarea, select, button {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.2rem;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    button {
      background: #00796b;
      color: white;
      cursor: pointer;
      margin-top: 1rem;
    }
    button:hover { background: #004d40; }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
    }
    .stat-card {
      background: #e0f2f1;
      padding: 1rem;
      border-radius: 8px;
      text-align: center;
      font-weight: bold;
    }
    .record {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #ccc;
      padding: 0.5rem 0;
    }
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #00796b;
      color: #fff;
      padding: 10px 20px;
      border-radius: 5px;
      display: none;
    }
    details.settings {
      margin-top: 2rem;
    }
  </style>
</head>
<body>
  <header>
    <h1>Fuel Tracker</h1>
    <p>Track fuel usage, cost, and mileage</p>
  </header>

  <div class="container">
    <div class="card">
      <h2>Add / Edit Fuel Entry</h2>
      <form id="fuelForm">
        <label>Date: <input type="date" id="date" required></label>
        <label>Start Meter: <input type="number" id="startMeter" required></label>
        <label>End Meter: <input type="number" id="endMeter" required></label>
        <label>Total Distance: <input type="number" id="totalDistance" readonly></label>
        <label>Fuel Added (L): <input type="number" id="fuelAdded" step="0.01" required></label>
        <label>Total Cost: <input type="number" id="fuelCost" step="0.01" required></label>
        <label>Bike Efficiency (km/L): <input type="number" id="bikeEfficiency" step="0.1" required></label>
        <label>Notes: <textarea id="notes"></textarea></label>
        <div id="fuelSummary"></div>
        <button type="submit" id="submitBtn">Add Entry</button>
      </form>
    </div>

    <div class="card">
      <h2>Stats</h2>
      <div class="stats-grid">
        <div class="stat-card">Total Cost: ‚Çπ<span id="totalCost">0</span></div>
        <div class="stat-card">Total Liters: <span id="totalLiters">0</span>L</div>
        <div class="stat-card">Total Distance: <span id="totalDistanceStat">0</span> km</div>
        <div class="stat-card">Avg Mileage: <span id="avgMileage">0</span> km/L</div>
        <div class="stat-card">Current Range: <span id="currentRange">0</span> km</div>
        <div class="stat-card">Cost/km: ‚Çπ<span id="costPerKm">0</span></div>
      </div>
    </div>

    <div class="card">
      <h2>Records</h2>
      <div id="recordsList"></div>
      <button onclick="exportCSV()">üì• Export CSV</button>
    </div>

    <div class="card">
      <h2>Monthly Summaries</h2>
      <div id="monthlySummary"></div>
    </div>

    <details class="settings">
      <summary>‚öôÔ∏è Settings</summary>
      <button onclick="clearAllData()" style="background:#b71c1c">Reset App (Clear All Data)</button>
    </details>
  </div>

  <div class="toast" id="toast">‚úÖ Saved successfully</div>

  <script>
    let records = JSON.parse(localStorage.getItem('fuelRecords')) || [];
    let editIndex = null;

    function showToast(msg) {
      const toast = document.getElementById('toast');
      toast.textContent = msg;
      toast.style.display = 'block';
      setTimeout(() => toast.style.display = 'none', 2000);
    }

    function setTodayDate() {
      document.getElementById('date').value = new Date().toISOString().split('T')[0];
    }

    function calculateDistance() {
      const start = parseFloat(document.getElementById('startMeter').value) || 0;
      const end = parseFloat(document.getElementById('endMeter').value) || 0;
      document.getElementById('totalDistance').value = end - start;
      calculateFuelDetails();
    }

    function calculateFuelDetails() {
      const fuel = parseFloat(document.getElementById('fuelAdded').value);
      const cost = parseFloat(document.getElementById('fuelCost').value);
      const distance = parseFloat(document.getElementById('totalDistance').value);
      const efficiency = parseFloat(document.getElementById('bikeEfficiency').value);

      if (!isNaN(fuel) && !isNaN(cost) && fuel > 0) {
        const pricePerLiter = (cost / fuel).toFixed(2);
        const mileage = (!isNaN(distance) && distance > 0 && fuel > 0) ? (distance / fuel).toFixed(2) : "-";
        const remainingRange = (!isNaN(efficiency) && fuel > 0) ? (efficiency * fuel).toFixed(0) : "-";

        document.getElementById('fuelSummary').innerHTML = 
          `<p>Price per liter: ‚Çπ${pricePerLiter}</p>
           <p>Actual Mileage: ${mileage} km/L</p>
           <p>Remaining Range: ${remainingRange} km</p>`;
      }
    }

    document.getElementById('fuelForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const entry = {
        date: document.getElementById('date').value,
        start: parseFloat(document.getElementById('startMeter').value),
        end: parseFloat(document.getElementById('endMeter').value),
        distance: parseFloat(document.getElementById('totalDistance').value),
        fuel: parseFloat(document.getElementById('fuelAdded').value),
        cost: parseFloat(document.getElementById('fuelCost').value),
        efficiency: parseFloat(document.getElementById('bikeEfficiency').value),
        notes: document.getElementById('notes').value
      };

      if (editIndex !== null) {
        records[editIndex] = entry;
        editIndex = null;
        document.getElementById('submitBtn').textContent = 'Add Entry';
      } else {
        records.push(entry);
      }

      localStorage.setItem('fuelRecords', JSON.stringify(records));
      updateDisplay();
      showToast('‚úÖ Saved successfully');
      this.reset();
      setTodayDate();
    });

    function deleteEntry(i) {
      records.splice(i,1);
      localStorage.setItem('fuelRecords', JSON.stringify(records));
      updateDisplay();
      showToast('üóëÔ∏è Entry deleted');
    }

    function editEntry(i) {
      const entry = records[i];
      document.getElementById('date').value = entry.date;
      document.getElementById('startMeter').value = entry.start;
      document.getElementById('endMeter').value = entry.end;
      document.getElementById('totalDistance').value = entry.distance;
      document.getElementById('fuelAdded').value = entry.fuel;
      document.getElementById('fuelCost').value = entry.cost;
      document.getElementById('bikeEfficiency').value = entry.efficiency;
      document.getElementById('notes').value = entry.notes;
      editIndex = i;
      document.getElementById('submitBtn').textContent = 'Update Entry';
    }

    function updateDisplay() {
      updateStats();
      updateRecordsList();
      updateMonthlySummary();
    }

    function updateStats() {
      const totalCost = records.reduce((sum,r)=>sum+r.cost,0);
      const totalLiters = records.reduce((sum,r)=>sum+r.fuel,0);
      const totalDistance = records.reduce((sum,r)=>sum+r.distance,0);
      const avgMileage = totalLiters>0 ? (totalDistance/totalLiters).toFixed(2) : 0;
      const costPerKm = totalDistance>0 ? (totalCost/totalDistance).toFixed(2) : 0;
      const currentRange = records.length>0 ? (records[records.length-1].efficiency * (records[records.length-1].fuel)).toFixed(0) : 0;

      document.getElementById('totalCost').textContent = totalCost.toFixed(2);
      document.getElementById('totalLiters').textContent = totalLiters.toFixed(2);
      document.getElementById('totalDistanceStat').textContent = totalDistance.toFixed(0);
      document.getElementById('avgMileage').textContent = avgMileage;
      document.getElementById('costPerKm').textContent = costPerKm;
      document.getElementById('currentRange').textContent = currentRange;
    }

    function updateRecordsList() {
      const list = document.getElementById('recordsList');
      list.innerHTML = '';
      records.forEach((r,i)=>{
        const div = document.createElement('div');
        div.className = 'record';
        div.innerHTML = `${r.date} - ${r.distance} km - ${r.fuel} L - ‚Çπ${r.cost}
          <span>
            <button onclick="editEntry(${i})">‚úèÔ∏è Edit</button>
            <button onclick="deleteEntry(${i})">üóëÔ∏è Delete</button>
          </span>`;
        list.appendChild(div);
      });
    }

    function updateMonthlySummary() {
      const summaryDiv = document.getElementById('monthlySummary');
      summaryDiv.innerHTML = '';
      const grouped = {};
      records.forEach(r=>{
        const month = r.date.slice(0,7);
        if (!grouped[month]) grouped[month] = {distance:0,fuel:0,cost:0};
        grouped[month].distance += r.distance;
        grouped[month].fuel += r.fuel;
        grouped[month].cost += r.cost;
      });
      for (const [month,data] of Object.entries(grouped)) {
        const mileage = data.fuel>0 ? (data.distance/data.fuel).toFixed(2):0;
        const div = document.createElement('div');
        div.className='record';
        div.textContent = `${month}: ${data.distance} km, ${data.fuel.toFixed(2)} L, ‚Çπ${data.cost.toFixed(2)}, Avg Mileage: ${mileage} km/L`;
        summaryDiv.appendChild(div);
      }
    }

    function exportCSV() {
      let csv = "Date,Start,End,Distance,Fuel,Cost,Efficiency,Notes\n";
      records.forEach(r=>{
        csv += `${r.date},${r.start},${r.end},${r.distance},${r.fuel},${r.cost},${r.efficiency},"${r.notes}"\n`;
      });
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'fuel_records.csv';
      a.click();
      URL.revokeObjectURL(url);
    }

    function clearAllData() {
      if(confirm("Are you sure you want to clear all data?")){
        records = [];
        localStorage.removeItem('fuelRecords');
        updateDisplay();
        showToast('‚ö†Ô∏è All data cleared');
      }
    }

    setTodayDate();
    updateDisplay();
  </script>
</body>
</html>
