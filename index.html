<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fuel & Cost Tracker</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f5f5f5; }
    .container { max-width: 1000px; margin: auto; padding: 20px; }
    .btn-group { display: flex; gap: 10px; margin-bottom: 20px; }
    button { padding: 10px 15px; cursor: pointer; border: none; border-radius: 6px; background: #4A4AFF; color: white; font-weight: bold; }
    button:hover { background: #3333cc; }
    .entry-form-section { display: none; }
    .card { background: white; padding: 15px; border-radius: 10px; margin-bottom: 15px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background: #4A4AFF; color: white; }
    .action-group { display: flex; gap: 5px; justify-content: center; }
    .action-btn { padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer; font-size: 0.9em; }
    .action-btn.edit { background: #ffc107; }
    .action-btn.delete { background: #dc3545; color: white; }
    #totalsSummaryCard, #costSummaryCard { border: 2px solid #4A4AFF; border-radius: 8px; padding: 15px; margin-bottom: 15px; background: #f9f9ff; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    #totalsSummary, #costSummary { text-align:center; font-size:1.1em; line-height:1.8; }
  </style>
</head>
<body>
  <div class="container">
    <div class="btn-group">
      <button onclick="showSection('fuelMeterSection')">Fuel Meter Entry</button>
      <button onclick="showSection('costSection')">Cost Expenditure</button>
    </div>

    <!-- Fuel Section -->
    <div id="fuelMeterSection" class="entry-form-section">
      <div class="card" id="totalsSummaryCard">
        <h3 style="margin-top: 0; text-align:center;">Current Fuel Status</h3>
        <div id="totalsSummary"></div>
      </div>
      <div class="card">
        <h2>Fuel Meter Entry</h2>
        <form id="fuelForm">
          <div style="display:flex; flex-wrap:wrap; gap:10px;">
            <input type="date" id="date" required>
            <input type="number" id="meterStart" placeholder="Meter Start" required>
            <input type="number" id="meterEnd" placeholder="Meter End" required>
            <input type="number" id="distance" placeholder="Distance" readonly>
            <input type="number" id="fuel" placeholder="Fuel (liters)" required>
            <input type="number" id="cost" placeholder="Cost (‚Çπ)" required>
            <input type="number" id="remainingKm" placeholder="Remaining KM" required>
            <button type="submit">Save</button>
          </div>
        </form>
        <table id="fuelTable">
          <thead>
            <tr>
              <th>Date</th>
              <th>Meter Start</th>
              <th>Meter End</th>
              <th>Distance</th>
              <th>Fuel (L)</th>
              <th>Cost (‚Çπ)</th>
              <th>Remaining KM</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- Cost Section -->
    <div id="costSection" class="entry-form-section">
      <div class="card" id="costSummaryCard">
        <h3 style="margin-top: 0; text-align:center;">Cost Summary</h3>
        <div id="costSummary"></div>
      </div>
      <div class="card">
        <h2>Cost Expenditure</h2>
        <form id="costForm">
          <div style="display:flex; flex-wrap:wrap; gap:10px;">
            <input type="date" id="costDate" required>
            <select id="costItem" required>
              <option value="Petrol">Petrol</option>
              <option value="Goods">Goods</option>
              <option value="Maintenance">Maintenance</option>
              <option value="Others">Others</option>
            </select>
            <div id="costSubItemDiv" style="display:none;">
              <label for="costSubItem">Details</label>
              <select id="costSubItem" aria-label="Cost Sub Item"></select>
            </div>
            <input type="number" id="costAmount" placeholder="Cost (‚Çπ)" required>
            <button type="submit">Save</button>
          </div>
        </form>
        <table id="costTable">
          <thead>
            <tr>
              <th>Date</th>
              <th>Item</th>
              <th>Details</th>
              <th>Cost (‚Çπ)</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <script type="module">
    let fuelRecords = [];
    let costRecords = [];
    let editFuelIndex = -1;
    let editCostIndex = -1;

    const num = (v) => Number(v || 0);

    function showSection(id) {
      document.querySelectorAll('.entry-form-section').forEach(sec => sec.style.display = 'none');
      document.getElementById(id).style.display = 'block';
    }

    // ---------------- Fuel ----------------
    document.getElementById('fuelForm').addEventListener('submit', function(e) {
      e.preventDefault();
      let date = document.getElementById('date').value;
      let meterStart = num(document.getElementById('meterStart').value);
      let meterEnd = num(document.getElementById('meterEnd').value);
      let distance = meterEnd - meterStart;
      document.getElementById('distance').value = distance;
      let fuel = num(document.getElementById('fuel').value);
      let cost = num(document.getElementById('cost').value);
      let remainingKm = num(document.getElementById('remainingKm').value);

      let record = { date, meterStart, meterEnd, distance, fuel, cost, remainingKm };

      if (editFuelIndex >= 0) {
        fuelRecords[editFuelIndex] = record;
        editFuelIndex = -1;
      } else {
        fuelRecords.push(record);
      }

      this.reset();
      renderFuelTable();
      renderFuelSummary();
    });

    window.renderFuelTable = function() {
      let tbody = document.querySelector('#fuelTable tbody');
      tbody.innerHTML = '';
      fuelRecords.forEach((rec, idx) => {
        let row = `<tr>
          <td>${rec.date}</td>
          <td>${rec.meterStart}</td>
          <td>${rec.meterEnd}</td>
          <td>${rec.distance}</td>
          <td>${rec.fuel}</td>
          <td>‚Çπ${rec.cost.toFixed(2)}</td>
          <td>${rec.remainingKm}</td>
          <td>
            <div class="action-group">
              <button onclick="editFuelRecord(${idx})" class="action-btn edit">‚úèÔ∏è Edit</button>
              <button onclick="deleteFuelRecord(${idx})" class="action-btn delete">üóëÔ∏è Delete</button>
            </div>
          </td>
        </tr>`;
        tbody.innerHTML += row;
      });
    };

    window.renderFuelSummary = function() {
      if (!fuelRecords.length) {
        document.getElementById('totalsSummary').innerHTML = `<b>No fuel data yet.</b>`;
        return;
      }

      let totalFuel = fuelRecords.reduce((a, r) => a + num(r.fuel), 0);
      let totalCost = fuelRecords.reduce((a, r) => a + num(r.cost), 0);
      let totalDistance = fuelRecords.reduce((a, r) => a + num(r.distance), 0);

      document.getElementById('totalsSummary').innerHTML = `
        <b>Total Fuel:</b> ${totalFuel.toFixed(2)} L<br>
        <b>Total Cost:</b> ‚Çπ${totalCost.toFixed(2)}<br>
        <b>Total Distance:</b> ${totalDistance.toFixed(2)} km
      `;
    };

    window.editFuelRecord = function(i) {
      let rec = fuelRecords[i];
      document.getElementById('date').value = rec.date;
      document.getElementById('meterStart').value = rec.meterStart;
      document.getElementById('meterEnd').value = rec.meterEnd;
      document.getElementById('distance').value = rec.distance;
      document.getElementById('fuel').value = rec.fuel;
      document.getElementById('cost').value = rec.cost;
      document.getElementById('remainingKm').value = rec.remainingKm;
      editFuelIndex = i;
    };

    window.deleteFuelRecord = function(i) {
      fuelRecords.splice(i, 1);
      renderFuelTable();
      renderFuelSummary();
    };

    // ---------------- Cost ----------------
    const subOptions = {
      "Goods": ["Powerbank", "Mobile Holder"],
      "Maintenance": ["Service", "Oil Change", "Spare Parts"]
    };

    document.getElementById("costItem").addEventListener("change", function() {
      const selected = this.value;
      const subDiv = document.getElementById("costSubItemDiv");
      const subSelect = document.getElementById("costSubItem");

      if (subOptions.hasOwnProperty(selected)) {
        subSelect.innerHTML = subOptions[selected]
          .map(opt => `<option value="${opt}">${opt}</option>`)
          .join("");
        subDiv.style.display = "block";
      } else {
        subDiv.style.display = "none";
        subSelect.innerHTML = "";
      }
    });

    document.getElementById('costForm').addEventListener('submit', function(e) {
      e.preventDefault();
      let date = document.getElementById('costDate').value;
      let item = document.getElementById('costItem').value;
      let subItem = document.getElementById('costSubItem').value || '';
      let cost = num(document.getElementById('costAmount').value);

      let record = { date, item, subItem, cost };

      if (editCostIndex >= 0) {
        costRecords[editCostIndex] = record;
        editCostIndex = -1;
      } else {
        costRecords.push(record);
      }

      this.reset();
      document.getElementById('costSubItemDiv').style.display = 'none';
      renderCostTable();
    });

    window.renderCostTable = function() {
      let tbody = document.querySelector('#costTable tbody');
      tbody.innerHTML = '';
      costRecords.forEach((rec, idx) => {
        let row = `<tr>
          <td>${rec.date}</td>
          <td>${rec.item}</td>
          <td>${rec.subItem}</td>
          <td>‚Çπ${rec.cost.toFixed(2)}</td>
          <td>
            <div class="action-group">
              <button onclick="editCostRecord(${idx})" class="action-btn edit">‚úèÔ∏è Edit</button>
              <button onclick="deleteCostRecord(${idx})" class="action-btn delete">üóëÔ∏è Delete</button>
            </div>
          </td>
        </tr>`;
        tbody.innerHTML += row;
      });
      renderCostSummary();
    };

    window.renderCostSummary = function() {
      if (!costRecords.length) {
        document.getElementById('costSummary').innerHTML = `<b>No cost data yet.</b>`;
        return;
      }

      // Group by category
      let categories = {};
      costRecords.forEach(r => {
        categories[r.item] = (categories[r.item] || 0) + num(r.cost);
      });

      // Show side by side
      let summaryHTML = `<div style="display:flex; flex-wrap:wrap; justify-content:center; gap:20px;">`;
      Object.keys(categories).forEach(cat => {
        summaryHTML += `<div><b>Total Spent ${cat}:</b> ‚Çπ${categories[cat].toFixed(2)}</div>`;
      });
      summaryHTML += `</div>`;

      document.getElementById('costSummary').innerHTML = summaryHTML;
    };

    window.editCostRecord = function(i) {
      let rec = costRecords[i];
      document.getElementById('costDate').value = rec.date;
      document.getElementById('costItem').value = rec.item;
      document.getElementById('costItem').dispatchEvent(new Event('change'));
      if (rec.subItem) document.getElementById('costSubItem').value = rec.subItem;
      document.getElementById('costAmount').value = rec.cost;
      editCostIndex = i;
    };

    window.deleteCostRecord = function(i) {
      costRecords.splice(i, 1);
      renderCostTable();
    };

    // Show Fuel section by default when page loads
    showSection('fuelMeterSection');
  </script>
</body>
</html>
